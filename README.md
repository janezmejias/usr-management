# usr-management-ms

### Introduction

The microservice described in the image is designed to expose a RESTful API for user creation. Here's a summary of its functions and features:

- **User Registration**: Provides an endpoint to register new users. This endpoint accepts user data in JSON format, which includes the name, email, password, and a list of phone objects. Each phone object has a number, a city code, and a country code.

- **Error Message Structure**: All endpoints must accept and return data in JSON format only. Even error messages must follow this format, providing a "message" field with the error description.

- **Registration Response**:
    - On successful registration, the service should return an appropriate HTTP status code along with a JSON object that includes various user fields:
        - `id`: The unique identifier for the user, generated by the database or preferably as a UUID.
        - `created`: The creation date of the user.
        - `modified`: The date of the last update of the user, which for a new user will coincide with the creation date.
        - `last_login`: The date of the last login of the user, which for a new user will be the creation date.
        - `token`: An access token for the API, which could be a UUID or JWT (JSON Web Token).
        - `isactive`: A boolean field indicating whether the user remains enabled within the system.

- **Error Handling**: In case of an error, such as an email that is already registered, the service should return an error with an appropriate message, for example, "The email is already registered."

This service must be capable of properly handling registration requests, validating input data, and providing informative responses in both successful and error scenarios, following RESTful principles and good API design practices.

### Starting the Application

Run the `KApplication` class


![diagram-class.jpeg](img%2Fdiagram-class.jpeg)
high-level architecture for a Spring Boot application concerning user management, particularly focused on security and user registration functionality

## OpenAPI definition
* http://localhost:8080/swagger-ui/index.html
![open-api.png](img%2Fopen-api.png)

## H2 Console

In order to see and interact with your db, access the h2 console in your browser.
After running the application, go to:

http://localhost:8080/api/user/h2-console

Enter the information for the url, username, and password in the application.yml:

```yml
url: jdbc:h2:mem:testdb
username: sa 
password: password
```

You should be able to see a db console now that has the Sample Repository in it.

Type:

```sql
SELECT * FROM PHONE;
SELECT * FROM USERS 
````

Click `Run`, you should see two rows, for ids `1` and `2`

### Hexagonal Architecture
```batch
.
└── usermanagement
    └── core
        ├── application
        │   └── config
        │       ├── CustomConfiguration.java
        │       ├── exceptions
        │       │   └── BaseException.java
        │       ├── JwtAuthenticationFilter.java
        │       └── SecurityConfig.java
        ├── domain
        │   ├── dto
        │   │   ├── PhoneRequest.java
        │   │   ├── SignUpResponse.java
        │   │   └── UserRequest.java
        │   ├── mapper
        │   │   └── UserMapper.java
        │   └── service
        │       └── UserService.java
        ├── infrastructure
        │   ├── controller
        │   │   ├── advice
        │   │   │   ├── BaseExceptionHandler.java
        │   │   │   └── ResponseError.java
        │   │   └── UserController.java
        │   └── repository
        │       ├── entities
        │       │   ├── Phone.java
        │       │   └── User.java
        │       ├── PhoneRepository.java
        │       └── UserRepository.java
        └── KApplication.java

14 directories, 17 files

```

#### cURL Example
```bash
curl --location 'http://localhost:8080/api/user/sign-up' \
--header 'Content-Type: application/json' \
--data-raw '{
    "name": "Juan Anez",
    "email": "janezmejias.09@gmail.com",
    "password": "Devbloc.09",
    "phones": [
        {
            "number": "3005650780",
            "cityCode": "1",
            "countryCode": "57"
        }
    ]
}'
```


## Unit Test
### Run All Test
```batch
gradle test
```

### Coverage
![all-converag.png](img%2Fall-converag.png)
### SonarLint
![sonar-lint.png](img%2Fsonar-lint.png)